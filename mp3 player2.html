<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Official Player Hub | Heat_In_The_Desert_Guy</title>
    <!-- Frameworks & Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        .font-brand { font-family: 'Space Grotesk', sans-serif; letter-spacing: -0.02em; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow { animation: spin-slow 10s linear infinite; }
        
        .bg-desert-gradient {
            background: radial-gradient(circle at center, rgba(255, 62, 62, 0.15) 0%, transparent 40%), 
                        radial-gradient(circle at 20% 30%, rgba(112, 0, 255, 0.12) 0%, transparent 30%);
        }

        /* Custom range styling */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 12px;
            width: 12px;
            border-radius: 50%;
            background: #ef4444;
            cursor: pointer;
        }

        .dark-mode { background-color: #050507; color: #f1f5f9; }
        .light-mode { background-color: #f1f5f9; color: #0f172a; }
        
        .transition-theme { transition: background-color 0.5s ease, color 0.5s ease; }
    </style>
</head>
<body class="dark-mode transition-theme overflow-x-hidden">

    <!-- HEADER DOCK -->
    <header id="mainHeader" class="fixed top-0 left-0 right-0 z-[2000] border-b border-white/10 backdrop-blur-xl py-3 px-6 flex justify-between items-center bg-[#050507]/80">
        <div class="flex items-center gap-4">
            <span id="clock" class="bg-black/40 border border-white/10 text-[11px] font-mono px-3 py-1.5 rounded-lg text-red-500">
                00:00:00
            </span>
        </div>
        
        <div class="flex items-center gap-2">
            <a href="https://heatinthedesertguy.netlify.app/" class="w-10 h-10 flex items-center justify-center rounded-xl bg-white/5 border border-white/10 hover:bg-red-500 hover:text-white transition-all" title="Home">
                <i data-lucide="home" class="w-[18px]"></i>
            </a>
            <a href="https://heatinthedesertguy.netlify.app/pulsepathv02#" class="w-10 h-10 flex items-center justify-center rounded-xl bg-white/5 border border-white/10 hover:bg-red-500 hover:text-white transition-all" title="PulsePath">
                <i data-lucide="heart-pulse" class="w-[18px]"></i>
            </a>
            <a href="#" class="w-10 h-10 flex items-center justify-center rounded-xl bg-white/5 border border-white/10 hover:bg-red-500 hover:text-white transition-all" title="Music">
                <i data-lucide="disc" class="w-[18px]"></i>
            </a>
            <a href="https://heatinthedesertguy.netlify.app/XboxGREPfdowngrader.html" class="w-10 h-10 flex items-center justify-center rounded-xl bg-white/5 border border-white/10 hover:bg-red-500 hover:text-white transition-all" title="Xbox">
                <i data-lucide="disc" class="w-[18px] rotate-45"></i>
            </a>
            <a href="https://heatinthedesertguy.netlify.app/faceswapv1.html" class="w-10 h-10 flex items-center justify-center rounded-xl bg-white/5 border border-white/10 hover:bg-red-500 hover:text-white transition-all" title="AI Swap">
                <i data-lucide="wand-2" class="w-[18px]"></i>
            </a>
            <div class="w-[1px] h-6 bg-white/10 mx-2"></div>
            <button id="themeToggle" class="w-10 h-10 flex items-center justify-center rounded-xl bg-white/5 border border-white/10 text-amber-400 hover:scale-110 transition-all">
                <i data-lucide="sun" class="w-[18px]"></i>
            </button>
        </div>
    </header>

    <!-- HERO SECTION -->
    <section class="relative pt-32 pb-20 px-6 overflow-hidden text-center">
        <div id="bgPulse" class="absolute inset-0 z-0 pointer-events-none opacity-40 bg-desert-gradient animate-[spin_20s_linear_infinite]"></div>

        <div class="relative z-10 max-w-4xl mx-auto">
            <div class="inline-flex items-center gap-8 px-8 py-3 bg-white/5 border border-white/10 backdrop-blur-2xl rounded-full mb-8 shadow-2xl relative font-brand">
                <div class="flex items-baseline gap-1.5">
                    <span class="text-xl font-bold text-red-500">106</span>
                    <span class="text-[10px] uppercase font-bold opacity-50 tracking-widest">Subs</span>
                </div>
                <div class="flex items-baseline gap-1.5">
                    <span class="text-xl font-bold text-red-500">24</span>
                    <span class="text-[10px] uppercase font-bold opacity-50 tracking-widest">Videos</span>
                </div>
                <div class="flex items-baseline gap-1.5">
                    <span class="text-xl font-bold text-red-500">91.8K</span>
                    <span class="text-[10px] uppercase font-bold opacity-50 tracking-widest">Views</span>
                </div>
                <button id="refreshStats" class="absolute -right-12 text-slate-500 hover:text-red-500 transition-all">
                    <i data-lucide="refresh-cw" class="w-[18px]"></i>
                </button>
            </div>

            <h1 class="text-5xl md:text-7xl font-bold mb-6 tracking-tight font-brand text-white">
                Heat_In_The_Desert_Guy
            </h1>
            <p class="text-lg opacity-60 mb-10 max-w-2xl mx-auto leading-relaxed">
                Exploring the digital desert. Content, tools, and updates from the frontline of creation.
            </p>
            
            <div class="flex justify-center gap-4">
                <a href="https://www.youtube.com/@Heat_In_The_Desert_Guy" target="_blank" class="px-10 py-4 bg-red-600 hover:bg-red-700 text-white rounded-full font-bold transition-all shadow-xl flex items-center gap-2 no-underline font-brand">
                    <i data-lucide="youtube" class="w-[20px]"></i> Subscribe
                </a>
            </div>
        </div>
    </section>

    <!-- APP CONTENT AREA -->
    <section class="max-w-7xl mx-auto px-6 pb-40">
        <div class="bg-slate-900/40 border border-white/5 rounded-[40px] overflow-hidden backdrop-blur-md">
            <div class="flex flex-col md:flex-row h-[700px]">
                <!-- Nav Rail -->
                <div class="w-full md:w-20 border-b md:border-b-0 md:border-r border-white/5 p-4 flex flex-row md:flex-col items-center gap-4">
                    <button id="tabRadio" class="w-12 h-12 rounded-2xl flex items-center justify-center transition-all bg-red-600 text-white">
                        <i data-lucide="globe" class="w-[24px]"></i>
                    </button>
                    <button id="tabPlayer" class="w-12 h-12 rounded-2xl flex items-center justify-center transition-all hover:bg-white/5 text-slate-400">
                        <i data-lucide="music" class="w-[24px]"></i>
                    </button>
                </div>

                <!-- List and Explorer -->
                <div class="flex-1 flex flex-col min-w-0">
                    <header class="p-6 border-b border-white/5 flex flex-col sm:flex-row gap-4 justify-between items-center">
                        <div class="relative w-full max-w-sm">
                            <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 w-[18px]"></i>
                            <input id="searchInput" type="text" placeholder="Search frequencies..."
                                class="w-full bg-black/40 border border-white/10 rounded-full py-2.5 pl-12 pr-6 text-sm focus:border-red-500 outline-none">
                        </div>
                        <div id="countrySelectorContainer">
                            <select id="countrySelect" class="bg-black/40 border border-white/10 rounded-xl px-4 py-2.5 text-xs outline-none focus:border-red-500 font-brand">
                                <!-- Options populated by JS -->
                            </select>
                        </div>
                    </header>

                    <div id="contentGrid" class="flex-1 overflow-y-auto p-6 scrollbar-hide grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 content-start">
                        <!-- Items populated by JS -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- PLAYER CONTROLLER (FLOATING) -->
    <footer class="fixed bottom-10 left-1/2 -translate-x-1/2 w-[90%] max-w-3xl z-[2000]">
        <div class="bg-slate-900/80 border border-white/10 backdrop-blur-2xl rounded-full px-8 py-4 flex items-center justify-between shadow-2xl">
            <div class="flex items-center gap-4 w-1/3 min-w-0">
                <div id="trackDisk" class="w-12 h-12 rounded-full flex items-center justify-center overflow-hidden border border-white/10 bg-slate-800 transition-all">
                    <i data-lucide="disc" id="diskIcon" class="text-red-500 w-[20px]"></i>
                </div>
                <div class="min-w-0 hidden sm:block">
                    <h6 id="currentTrackTitle" class="text-sm font-bold truncate font-brand">The Desert Silence</h6>
                    <p id="currentTrackArtist" class="text-[10px] text-red-500 font-bold uppercase tracking-widest truncate font-brand">Standby</p>
                </div>
            </div>

            <div class="flex items-center gap-6">
                <button id="prevBtn" class="text-slate-500 hover:text-white transition-all"><i data-lucide="skip-back" class="w-[20px]"></i></button>
                <button id="playBtn" class="w-14 h-14 bg-red-600 text-white rounded-full flex items-center justify-center hover:scale-105 active:scale-95 transition-all shadow-lg">
                    <i data-lucide="play" id="playIcon" class="w-[28px] fill-white ml-1"></i>
                </button>
                <button id="nextBtn" class="text-slate-500 hover:text-white transition-all"><i data-lucide="skip-forward" class="w-[20px]"></i></button>
            </div>

            <div class="flex items-center gap-3 w-1/3 justify-end">
                <i data-lucide="volume-2" class="text-slate-500 hidden sm:block w-[16px]"></i>
                <input id="volumeSlider" type="range" min="0" max="1" step="0.01" value="0.7"
                    class="w-20 accent-red-600 cursor-pointer h-1 bg-white/10 rounded-full appearance-none">
            </div>
        </div>
        <div id="errorMessage" class="hidden absolute top-[-40px] left-1/2 -translate-x-1/2 text-xs font-bold text-red-500 bg-black/80 px-4 py-1.5 rounded-full border border-red-500/20 font-brand">
            Stream blocked or offline.
        </div>
    </footer>

    <footer class="py-20 text-center opacity-30 text-[11px] uppercase tracking-[0.3em] font-bold font-brand">
        &copy; 2025 Heat_In_The_Desert_Guy
    </footer>

    <script>
        // --- State Management ---
        const apiKey = ""; // Set API key for Gemini here
        let activeTab = 'radio';
        let isDarkMode = true;
        let stations = [];
        let countries = [];
        let localTracks = [];
        let currentTrack = null;
        let isPlaying = false;
        let searchQuery = "";
        let selectedCountry = "US";

        const audio = new Audio();
        audio.volume = 0.7;

        // --- DOM Cache ---
        const dom = {
            clock: document.getElementById('clock'),
            themeToggle: document.getElementById('themeToggle'),
            mainHeader: document.getElementById('mainHeader'),
            tabRadio: document.getElementById('tabRadio'),
            tabPlayer: document.getElementById('tabPlayer'),
            searchInput: document.getElementById('searchInput'),
            countrySelect: document.getElementById('countrySelect'),
            countryContainer: document.getElementById('countrySelectorContainer'),
            contentGrid: document.getElementById('contentGrid'),
            playBtn: document.getElementById('playBtn'),
            playIcon: document.getElementById('playIcon'),
            volumeSlider: document.getElementById('volumeSlider'),
            trackDisk: document.getElementById('trackDisk'),
            diskIcon: document.getElementById('diskIcon'),
            trackTitle: document.getElementById('currentTrackTitle'),
            trackArtist: document.getElementById('currentTrackArtist'),
            errorMessage: document.getElementById('errorMessage'),
            refreshStats: document.getElementById('refreshStats')
        };

        // --- Initialization ---
        function init() {
            lucide.createIcons();
            startClock();
            loadCountries();
            loadStations(selectedCountry);
            setupListeners();
        }

        function startClock() {
            setInterval(() => {
                dom.clock.innerText = new Date().toLocaleTimeString();
            }, 1000);
        }

        // --- API & Data Logic ---
        async function loadCountries() {
            try {
                const res = await fetch('https://de1.api.radio-browser.info/json/countries');
                countries = await res.json();
                countries.sort((a, b) => b.stationcount - a.stationcount);
                const topCountries = countries.slice(0, 50);
                
                dom.countrySelect.innerHTML = topCountries.map(c => 
                    `<option value="${c.iso_3166_1}" ${c.iso_3166_1 === 'US' ? 'selected' : ''}>${c.name}</option>`
                ).join('');
            } catch (e) { console.error("Countries failed", e); }
        }

        async function loadStations(countryCode) {
            dom.contentGrid.innerHTML = `
                <div class="col-span-full h-64 flex flex-col items-center justify-center gap-3 opacity-30 italic">
                    <i data-lucide="refresh-cw" class="animate-spin w-8 h-8"></i>
                    <p class="font-brand uppercase tracking-widest text-xs">Scouring the desert signals...</p>
                </div>
            `;
            lucide.createIcons();
            
            try {
                const res = await fetch(`https://de1.api.radio-browser.info/json/stations/bycountrycodeexact/${countryCode}?limit=24&order=clickcount&reverse=true`);
                stations = await res.json();
                render();
            } catch (e) { console.error("Stations failed", e); }
        }

        async function getGeminiMetadata(filename) {
            if (!apiKey) return { artist: "Desert Unknown", album: "Desert Session" };
            
            try {
                const prompt = `Identify the likely artist and album name for the audio file named "${filename}". Return only valid JSON with keys "artist" and "album".`;
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: { responseMimeType: "application/json" }
                    })
                });
                const data = await response.json();
                return JSON.parse(data.candidates[0].content.parts[0].text);
            } catch (err) {
                return { artist: "Local Track", album: "Unknown" };
            }
        }

        // --- Rendering ---
        function render() {
            dom.contentGrid.innerHTML = '';
            
            if (activeTab === 'radio') {
                const filtered = stations.filter(s => s.name.toLowerCase().includes(searchQuery.toLowerCase()));
                filtered.forEach(station => {
                    const isActive = currentTrack?.stationuuid === station.stationuuid;
                    const card = document.createElement('button');
                    card.className = `flex items-center gap-4 p-4 rounded-2xl border text-left transition-all ${isActive ? 'bg-red-600/10 border-red-500/50' : 'bg-white/5 border-white/5 hover:bg-white/10'}`;
                    card.onclick = () => playMedia(station, 'radio');
                    card.innerHTML = `
                        <div class="w-12 h-12 bg-slate-800 rounded-xl overflow-hidden flex-shrink-0 flex items-center justify-center">
                            ${station.favicon ? `<img src="${station.favicon}" class="w-full h-full object-cover">` : `<i data-lucide="radio-tower" class="w-5 h-5"></i>`}
                        </div>
                        <div class="min-w-0">
                            <h4 class="text-sm font-bold truncate font-brand">${station.name}</h4>
                            <p class="text-[10px] uppercase opacity-50 tracking-wider truncate font-brand">${station.tags || station.country}</p>
                        </div>
                    `;
                    dom.contentGrid.appendChild(card);
                });
            } else {
                // Local Tab
                const uploadCard = document.createElement('label');
                uploadCard.className = "p-4 h-full rounded-2xl border border-dashed border-white/10 bg-white/5 flex flex-col items-center justify-center gap-2 cursor-pointer hover:border-red-500 transition-all font-brand group";
                uploadCard.innerHTML = `
                    <input type="file" multiple id="fileUpload" class="hidden">
                    <i data-lucide="disc" class="text-slate-500 group-hover:text-red-500 transition-colors w-6 h-6"></i>
                    <span class="text-[10px] uppercase font-bold text-slate-500 group-hover:text-white">Add Local Files</span>
                `;
                dom.contentGrid.appendChild(uploadCard);
                
                uploadCard.querySelector('#fileUpload').onchange = handleFileUpload;

                localTracks.forEach(track => {
                    const isActive = currentTrack?.id === track.id;
                    const card = document.createElement('button');
                    card.className = `flex items-center gap-4 p-4 rounded-2xl border text-left transition-all ${isActive ? 'bg-red-600/10 border-red-500/50' : 'bg-white/5 border-white/5 hover:bg-white/10'}`;
                    card.onclick = () => playMedia(track, 'local');
                    card.innerHTML = `
                        <div class="w-12 h-12 bg-red-600/20 text-red-500 rounded-xl flex items-center justify-center">
                            <i data-lucide="music" class="w-5 h-5"></i>
                        </div>
                        <div class="min-w-0">
                            <h4 class="text-sm font-bold truncate font-brand">${track.name}</h4>
                            <p class="text-[10px] uppercase opacity-50 tracking-wider truncate font-brand">${track.artist}</p>
                        </div>
                    `;
                    dom.contentGrid.appendChild(card);
                });
            }
            lucide.createIcons();
        }

        // --- Audio Logic ---
        function playMedia(item, type) {
            dom.errorMessage.classList.add('hidden');
            audio.pause();
            audio.src = type === 'radio' ? item.url_resolved : item.url;
            audio.load();
            
            const playPromise = audio.play();
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    isPlaying = true;
                    currentTrack = { ...item, type };
                    updatePlayerUI();
                    render();
                }).catch(err => {
                    console.error("Playback failed", err);
                    dom.errorMessage.classList.remove('hidden');
                    isPlaying = false;
                    updatePlayerUI();
                });
            }
        }

        function togglePlay() {
            if (!audio.src) return;
            if (isPlaying) {
                audio.pause();
                isPlaying = false;
            } else {
                audio.play();
                isPlaying = true;
            }
            updatePlayerUI();
        }

        function updatePlayerUI() {
            // Update Play Icon
            dom.playIcon.setAttribute('data-lucide', isPlaying ? 'pause' : 'play');
            dom.playIcon.classList.toggle('ml-1', !isPlaying);
            
            // Disk Animation
            if (isPlaying) dom.trackDisk.classList.add('animate-spin-slow');
            else dom.trackDisk.classList.remove('animate-spin-slow');
            
            if (currentTrack) {
                dom.trackTitle.innerText = currentTrack.name || currentTrack.tags;
                dom.trackArtist.innerText = currentTrack.artist || currentTrack.country || "Frequency Stream";
                
                if (currentTrack.favicon) {
                    dom.trackDisk.innerHTML = `<img src="${currentTrack.favicon}" class="w-full h-full object-cover">`;
                } else {
                    dom.trackDisk.innerHTML = `<i data-lucide="disc" class="text-red-500 w-[20px]"></i>`;
                }
            }
            lucide.createIcons();
        }

        async function handleFileUpload(e) {
            const files = Array.from(e.target.files);
            for (const file of files) {
                const meta = await getGeminiMetadata(file.name);
                localTracks.push({
                    id: Math.random().toString(36),
                    name: file.name.replace(/\.[^/.]+$/, ""),
                    artist: meta.artist,
                    url: URL.createObjectURL(file),
                    type: 'local'
                });
            }
            render();
        }

        // --- Event Listeners ---
        function setupListeners() {
            dom.themeToggle.onclick = () => {
                isDarkMode = !isDarkMode;
                document.body.className = isDarkMode ? 'dark-mode transition-theme overflow-x-hidden' : 'light-mode transition-theme overflow-x-hidden';
                dom.mainHeader.className = `fixed top-0 left-0 right-0 z-[2000] border-b backdrop-blur-xl py-3 px-6 flex justify-between items-center transition-all ${isDarkMode ? 'bg-[#050507]/80 border-white/10' : 'bg-white/80 border-black/10'}`;
                dom.themeToggle.innerHTML = isDarkMode ? `<i data-lucide="sun" class="w-[18px]"></i>` : `<i data-lucide="moon" class="w-[18px]"></i>`;
                lucide.createIcons();
            };

            dom.tabRadio.onclick = () => {
                activeTab = 'radio';
                dom.tabRadio.className = "w-12 h-12 rounded-2xl flex items-center justify-center transition-all bg-red-600 text-white";
                dom.tabPlayer.className = "w-12 h-12 rounded-2xl flex items-center justify-center transition-all hover:bg-white/5 text-slate-400";
                dom.countryContainer.classList.remove('hidden');
                render();
            };

            dom.tabPlayer.onclick = () => {
                activeTab = 'player';
                dom.tabPlayer.className = "w-12 h-12 rounded-2xl flex items-center justify-center transition-all bg-red-600 text-white";
                dom.tabRadio.className = "w-12 h-12 rounded-2xl flex items-center justify-center transition-all hover:bg-white/5 text-slate-400";
                dom.countryContainer.classList.add('hidden');
                render();
            };

            dom.searchInput.oninput = (e) => {
                searchQuery = e.target.value;
                render();
            };

            dom.countrySelect.onchange = (e) => {
                selectedCountry = e.target.value;
                loadStations(selectedCountry);
            };

            dom.playBtn.onclick = togglePlay;
            
            dom.volumeSlider.oninput = (e) => {
                audio.volume = e.target.value;
            };

            dom.refreshStats.onclick = () => {
                dom.refreshStats.classList.add('animate-spin');
                setTimeout(() => dom.refreshStats.classList.remove('animate-spin'), 1000);
            };

            audio.onerror = () => {
                dom.errorMessage.classList.remove('hidden');
                isPlaying = false;
                updatePlayerUI();
            };
        }

        window.onload = init;
    </script>
</body>
</html>
