<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Official Player Hub | Heat_In_The_Desert_Guy</title>
    
    <!-- External CSS & Frameworks -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        :root {
            --desert-red: #ef4444;
            --desert-dark: #050507;
            --desert-card: rgba(15, 23, 42, 0.4);
        }

        body { 
            font-family: 'Inter', sans-serif; 
            transition: background-color 0.5s ease, color 0.5s ease;
        }
        
        .font-brand { font-family: 'Space Grotesk', sans-serif; letter-spacing: -0.02em; }
        
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Animations */
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow { animation: spin-slow 10s linear infinite; }
        
        .bg-desert-gradient {
            background: radial-gradient(circle at center, rgba(255, 62, 62, 0.15) 0%, transparent 40%), 
                        radial-gradient(circle at 20% 30%, rgba(112, 0, 255, 0.12) 0%, transparent 30%);
        }

        /* Custom Input Styling */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 12px;
            width: 12px;
            border-radius: 50%;
            background: var(--desert-red);
            cursor: pointer;
        }

        .dark-mode { background-color: var(--desert-dark); color: #f1f5f9; }
        .light-mode { background-color: #f1f5f9; color: #0f172a; }

        /* Header Dock Styles */
        #mainHeader {
            transition: all 0.3s ease;
        }

        .nav-link-custom {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: inherit;
            transition: all 0.2s;
        }

        .nav-link-custom:hover {
            background: var(--desert-red);
            color: white !important;
            transform: translateY(-2px);
        }

        .active-tab {
            background: var(--desert-red) !important;
            color: white !important;
        }
    </style>
</head>
<body class="dark-mode overflow-x-hidden">

    <!-- HEADER DOCK (Synced with Primary Site) -->
    <header id="mainHeader" class="fixed-top border-b border-white/10 backdrop-blur-xl py-3 px-4 px-md-6 d-flex justify-content-between align-items-center bg-[#050507]/80 z-[2000]">
        <div class="d-flex align-items-center gap-3">
            <span id="clock" class="bg-black/40 border border-white/10 text-[11px] font-mono px-3 py-1.5 rounded-lg text-red-500">
                00:00:00
            </span>
        </div>
        
        <nav class="d-flex align-items-center gap-2">
            <!-- Navigation Sequence: PulsePath, Music, Xbox, FaceSwap -->
            <a href="/" class="nav-link-custom" title="Home">
                <i class="fa-solid fa-house-chimney fs-6"></i>
            </a>
            <a href="/pulsepathv02" class="nav-link-custom" title="PulsePath">
                <i class="fa-solid fa-heart-pulse fs-6"></i>
            </a>
            <a href="#" class="nav-link-custom active-tab" title="Music">
                <i class="fa-solid fa-compact-disc fs-6"></i>
            </a>
            <a href="/XboxGREPfdowngrader.html" class="nav-link-custom" title="Xbox">
                <i class="fa-brands fa-xbox fs-6"></i>
            </a>
            <a href="/faceswapv1.html" class="nav-link-custom" title="AI Swap">
                <i class="fa-solid fa-wand-magic-sparkles fs-6"></i>
            </a>
            
            <div class="vr mx-2 opacity-10 d-none d-md-block" style="height: 24px; color: white;"></div>
            
            <button id="themeToggle" class="nav-link-custom text-warning">
                <i class="fa-solid fa-sun fs-6"></i>
            </button>
        </nav>
    </header>

    <!-- HERO SECTION -->
    <section class="relative pt-32 pb-20 px-6 overflow-hidden text-center">
        <div id="bgPulse" class="absolute inset-0 z-0 pointer-events-none opacity-40 bg-desert-gradient animate-[spin_20s_linear_infinite]"></div>

        <div class="relative z-10 max-w-4xl mx-auto">
            <div class="inline-flex items-center gap-8 px-8 py-3 bg-white/5 border border-white/10 backdrop-blur-2xl rounded-full mb-8 shadow-2xl relative font-brand">
                <div class="flex items-baseline gap-1.5">
                    <span class="text-xl font-bold text-red-500">106</span>
                    <span class="text-[10px] uppercase font-bold opacity-50 tracking-widest">Subs</span>
                </div>
                <div class="flex items-baseline gap-1.5">
                    <span class="text-xl font-bold text-red-500">24</span>
                    <span class="text-[10px] uppercase font-bold opacity-50 tracking-widest">Videos</span>
                </div>
                <div class="flex items-baseline gap-1.5">
                    <span class="text-xl font-bold text-red-500">91.8K</span>
                    <span class="text-[10px] uppercase font-bold opacity-50 tracking-widest">Views</span>
                </div>
                <button id="refreshStats" class="absolute -right-12 text-slate-500 hover:text-red-500 transition-all">
                    <i data-lucide="refresh-cw" class="w-[18px]"></i>
                </button>
            </div>

            <h1 class="text-5xl md:text-7xl font-bold mb-6 tracking-tight font-brand text-white">
                Desert Audio Hub
            </h1>
            <p class="text-lg opacity-60 mb-10 max-w-2xl mx-auto leading-relaxed">
                Tune into global frequencies or upload your own desert sessions. Integrated with AI metadata analysis.
            </p>
        </div>
    </section>

    <!-- APP CONTENT AREA -->
    <section class="max-w-7xl mx-auto px-6 pb-40">
        <div class="bg-slate-900/40 border border-white/5 rounded-[40px] overflow-hidden backdrop-blur-md">
            <div class="flex flex-col md:flex-row h-[700px]">
                <!-- Nav Rail -->
                <div class="w-full md:w-20 border-b md:border-b-0 md:border-r border-white/5 p-4 flex flex-row md:flex-col items-center gap-4">
                    <button id="tabRadio" class="w-12 h-12 rounded-2xl flex items-center justify-center transition-all bg-red-600 text-white" title="Global Radio">
                        <i class="fa-solid fa-earth-americas fs-4"></i>
                    </button>
                    <button id="tabPlayer" class="w-12 h-12 rounded-2xl flex items-center justify-center transition-all hover:bg-white/5 text-slate-400" title="My Library">
                        <i class="fa-solid fa-music fs-4"></i>
                    </button>
                </div>

                <!-- List and Explorer -->
                <div class="flex-1 flex flex-col min-w-0">
                    <header class="p-6 border-b border-white/5 flex flex-col sm:flex-row gap-4 justify-between items-center">
                        <div class="relative w-full max-w-sm">
                            <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 w-[18px]"></i>
                            <input id="searchInput" type="text" placeholder="Search frequencies..."
                                class="w-full bg-black/40 border border-white/10 rounded-full py-2.5 pl-12 pr-6 text-sm focus:border-red-500 outline-none">
                        </div>
                        <div id="countrySelectorContainer">
                            <select id="countrySelect" class="bg-black/40 border border-white/10 rounded-xl px-4 py-2.5 text-xs outline-none focus:border-red-500 font-brand">
                                <!-- Loaded via API -->
                            </select>
                        </div>
                    </header>

                    <div id="contentGrid" class="flex-1 overflow-y-auto p-6 scrollbar-hide grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 content-start">
                        <!-- Items populated by JS -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- PLAYER CONTROLLER (FLOATING) -->
    <footer class="fixed bottom-10 left-1/2 -translate-x-1/2 w-[90%] max-w-3xl z-[2000]">
        <div class="bg-slate-900/80 border border-white/10 backdrop-blur-2xl rounded-full px-8 py-4 flex items-center justify-between shadow-2xl">
            <div class="flex items-center gap-4 w-1/3 min-w-0">
                <div id="trackDisk" class="w-12 h-12 rounded-full flex items-center justify-center overflow-hidden border border-white/10 bg-slate-800 transition-all">
                    <i class="fa-solid fa-compact-disc text-red-500 fs-4" id="diskIcon"></i>
                </div>
                <div class="min-w-0 hidden sm:block">
                    <h6 id="currentTrackTitle" class="text-sm font-bold truncate font-brand m-0">The Desert Silence</h6>
                    <p id="currentTrackArtist" class="text-[10px] text-red-500 font-bold uppercase tracking-widest truncate font-brand m-0">Standby</p>
                </div>
            </div>

            <div class="flex items-center gap-4">
                <button id="prevBtn" class="text-slate-500 hover:text-white transition-all"><i class="fa-solid fa-backward-step"></i></button>
                <button id="playBtn" class="w-14 h-14 bg-red-600 text-white rounded-full flex items-center justify-center hover:scale-105 active:scale-95 transition-all shadow-lg">
                    <i class="fa-solid fa-play fs-4" id="playIcon"></i>
                </button>
                <button id="nextBtn" class="text-slate-500 hover:text-white transition-all"><i class="fa-solid fa-forward-step"></i></button>
            </div>

            <div class="flex items-center gap-3 w-1/3 justify-end">
                <i class="fa-solid fa-volume-low text-slate-500 hidden sm:block"></i>
                <input id="volumeSlider" type="range" min="0" max="1" step="0.01" value="0.7"
                    class="w-20 accent-red-600 cursor-pointer h-1 bg-white/10 rounded-full appearance-none">
            </div>
        </div>
        <div id="errorMessage" class="hidden absolute top-[-40px] left-1/2 -translate-x-1/2 text-xs font-bold text-red-500 bg-black/80 px-4 py-1.5 rounded-full border border-red-500/20 font-brand">
            Stream blocked or offline.
        </div>
    </footer>

    <footer class="py-20 text-center opacity-30 text-[11px] uppercase tracking-[0.3em] font-bold font-brand">
        &copy; 2025 Heat_In_The_Desert_Guy | Audio Network
    </footer>

    <script>
        const apiKey = ""; // Gemini API Key
        let activeTab = 'radio';
        let isDarkMode = true;
        let stations = [];
        let localTracks = [];
        let currentTrack = null;
        let isPlaying = false;
        let searchQuery = "";
        let selectedCountry = "US";

        const audio = new Audio();
        audio.volume = 0.7;

        const dom = {
            clock: document.getElementById('clock'),
            themeToggle: document.getElementById('themeToggle'),
            tabRadio: document.getElementById('tabRadio'),
            tabPlayer: document.getElementById('tabPlayer'),
            searchInput: document.getElementById('searchInput'),
            countrySelect: document.getElementById('countrySelect'),
            contentGrid: document.getElementById('contentGrid'),
            playBtn: document.getElementById('playBtn'),
            playIcon: document.getElementById('playIcon'),
            volumeSlider: document.getElementById('volumeSlider'),
            trackDisk: document.getElementById('trackDisk'),
            trackTitle: document.getElementById('currentTrackTitle'),
            trackArtist: document.getElementById('currentTrackArtist'),
            errorMessage: document.getElementById('errorMessage'),
            refreshStats: document.getElementById('refreshStats')
        };

        async function init() {
            lucide.createIcons();
            startClock();
            await loadCountries();
            await loadStations(selectedCountry);
            setupListeners();
        }

        function startClock() {
            setInterval(() => {
                const now = new Date();
                dom.clock.innerText = now.toTimeString().split(' ')[0];
            }, 1000);
        }

        async function loadCountries() {
            try {
                const res = await fetch('https://de1.api.radio-browser.info/json/countries');
                const countries = await res.json();
                countries.sort((a, b) => b.stationcount - a.stationcount);
                dom.countrySelect.innerHTML = countries.slice(0, 40).map(c => 
                    `<option value="${c.iso_3166_1}" ${c.iso_3166_1 === 'US' ? 'selected' : ''}>${c.name}</option>`
                ).join('');
            } catch (e) { console.error("API error", e); }
        }

        async function loadStations(countryCode) {
            dom.contentGrid.innerHTML = `<div class="col-span-full py-20 text-center opacity-40 animate-pulse font-brand text-xs uppercase tracking-widest">Scanning signals...</div>`;
            try {
                const res = await fetch(`https://de1.api.radio-browser.info/json/stations/bycountrycodeexact/${countryCode}?limit=30&order=clickcount&reverse=true`);
                stations = await res.json();
                render();
            } catch (e) { console.error("Stations failed", e); }
        }

        function render() {
            dom.contentGrid.innerHTML = '';
            
            if (activeTab === 'radio') {
                const filtered = stations.filter(s => s.name.toLowerCase().includes(searchQuery.toLowerCase()));
                filtered.forEach(station => {
                    const isActive = currentTrack?.stationuuid === station.stationuuid;
                    const card = document.createElement('div');
                    card.className = `flex items-center gap-4 p-4 rounded-2xl border cursor-pointer transition-all ${isActive ? 'bg-red-600/10 border-red-500/50' : 'bg-white/5 border-white/5 hover:bg-white/10'}`;
                    card.onclick = () => playMedia(station, 'radio');
                    card.innerHTML = `
                        <div class="w-12 h-12 bg-slate-800 rounded-xl overflow-hidden flex-shrink-0 flex items-center justify-center">
                            ${station.favicon ? `<img src="${station.favicon}" class="w-full h-full object-cover">` : `<i class="fa-solid fa-tower-broadcast"></i>`}
                        </div>
                        <div class="min-w-0">
                            <h4 class="text-sm font-bold truncate font-brand mb-0">${station.name}</h4>
                            <p class="text-[10px] uppercase opacity-50 tracking-wider truncate font-brand mb-0">${station.tags || 'General'}</p>
                        </div>
                    `;
                    dom.contentGrid.appendChild(card);
                });
            } else {
                // Local Media Section
                const uploadBox = document.createElement('div');
                uploadBox.className = "p-4 h-full rounded-2xl border border-dashed border-white/10 bg-white/5 flex flex-col items-center justify-center gap-2 cursor-pointer hover:border-red-500 transition-all font-brand group";
                uploadBox.innerHTML = `<input type="file" multiple id="fileUpload" class="hidden"><i class="fa-solid fa-cloud-arrow-up text-slate-500 group-hover:text-red-500"></i><span class="text-[10px] uppercase font-bold text-slate-500">Add Tracks</span>`;
                uploadBox.onclick = () => document.getElementById('fileUpload').click();
                dom.contentGrid.appendChild(uploadBox);
                
                document.getElementById('fileUpload')?.addEventListener('change', handleFileUpload);

                localTracks.forEach(track => {
                    const isActive = currentTrack?.id === track.id;
                    const card = document.createElement('div');
                    card.className = `flex items-center gap-4 p-4 rounded-2xl border cursor-pointer transition-all ${isActive ? 'bg-red-600/10 border-red-500/50' : 'bg-white/5 border-white/5 hover:bg-white/10'}`;
                    card.onclick = () => playMedia(track, 'local');
                    card.innerHTML = `
                        <div class="w-12 h-12 bg-red-500/20 text-red-500 rounded-xl flex items-center justify-center">
                            <i class="fa-solid fa-music"></i>
                        </div>
                        <div class="min-w-0">
                            <h4 class="text-sm font-bold truncate font-brand mb-0">${track.name}</h4>
                            <p class="text-[10px] uppercase opacity-50 tracking-wider truncate font-brand mb-0">${track.artist}</p>
                        </div>
                    `;
                    dom.contentGrid.appendChild(card);
                });
            }
        }

        async function handleFileUpload(e) {
            const files = Array.from(e.target.files);
            for (const file of files) {
                const meta = await getGeminiMetadata(file.name);
                localTracks.push({
                    id: Math.random().toString(36),
                    name: file.name.replace(/\.[^/.]+$/, ""),
                    artist: meta.artist || "Local Artist",
                    url: URL.createObjectURL(file),
                    type: 'local'
                });
            }
            render();
        }

        async function getGeminiMetadata(filename) {
            if (!apiKey) return { artist: "Desert Unknown" };
            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `Extract probable artist name from filename: ${filename}. Return JSON: {"artist": "string"}` }] }],
                        generationConfig: { responseMimeType: "application/json" }
                    })
                });
                const data = await res.json();
                return JSON.parse(data.candidates[0].content.parts[0].text);
            } catch { return { artist: "Local Session" }; }
        }

        function playMedia(item, type) {
            dom.errorMessage.classList.add('hidden');
            audio.src = type === 'radio' ? item.url_resolved : item.url;
            audio.play().then(() => {
                isPlaying = true;
                currentTrack = { ...item, type };
                updatePlayerUI();
                render();
            }).catch(() => dom.errorMessage.classList.remove('hidden'));
        }

        function updatePlayerUI() {
            dom.playIcon.className = isPlaying ? 'fa-solid fa-pause fs-4' : 'fa-solid fa-play fs-4';
            if (isPlaying) dom.trackDisk.classList.add('animate-spin-slow');
            else dom.trackDisk.classList.remove('animate-spin-slow');
            
            if (currentTrack) {
                dom.trackTitle.innerText = currentTrack.name;
                dom.trackArtist.innerText = currentTrack.artist || currentTrack.country || "Network Frequency";
                if (currentTrack.favicon) {
                    dom.trackDisk.innerHTML = `<img src="${currentTrack.favicon}" class="w-full h-full object-cover">`;
                } else {
                    dom.trackDisk.innerHTML = `<i class="fa-solid fa-compact-disc text-red-500 fs-4"></i>`;
                }
            }
        }

        function setupListeners() {
            dom.themeToggle.onclick = () => {
                isDarkMode = !isDarkMode;
                document.body.className = isDarkMode ? 'dark-mode' : 'light-mode';
                dom.themeToggle.innerHTML = isDarkMode ? `<i class="fa-solid fa-sun"></i>` : `<i class="fa-solid fa-moon"></i>`;
            };

            dom.tabRadio.onclick = () => {
                activeTab = 'radio';
                dom.tabRadio.classList.add('bg-red-600', 'text-white');
                dom.tabRadio.classList.remove('text-slate-400');
                dom.tabPlayer.classList.remove('bg-red-600', 'text-white');
                dom.tabPlayer.classList.add('text-slate-400');
                render();
            };

            dom.tabPlayer.onclick = () => {
                activeTab = 'player';
                dom.tabPlayer.classList.add('bg-red-600', 'text-white');
                dom.tabPlayer.classList.remove('text-slate-400');
                dom.tabRadio.classList.remove('bg-red-600', 'text-white');
                dom.tabRadio.classList.add('text-slate-400');
                render();
            };

            dom.playBtn.onclick = () => {
                if (!audio.src) return;
                if (isPlaying) audio.pause(); else audio.play();
                isPlaying = !isPlaying;
                updatePlayerUI();
            };

            dom.volumeSlider.oninput = (e) => audio.volume = e.target.value;
            dom.searchInput.oninput = (e) => { searchQuery = e.target.value; render(); };
            dom.countrySelect.onchange = (e) => loadStations(e.target.value);
            
            dom.refreshStats.onclick = () => {
                dom.refreshStats.classList.add('animate-spin');
                setTimeout(() => dom.refreshStats.classList.remove('animate-spin'), 800);
            };
        }

        window.onload = init;
    </script>
</body>
</html>
