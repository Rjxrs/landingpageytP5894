<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xbox Era PFP Downgrader V2</title>
    <!-- Frameworks -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .font-brand { font-family: 'Space Grotesk', sans-serif; letter-spacing: -0.02em; }
        
        /* Dynamic Backgrounds */
        .bg-overlay {
            position: fixed; inset: 0; z-index: -1;
            background-size: cover; background-position: center;
            transition: opacity 1s ease-in-out;
        }

        .era-original { background-color: #000; }
        .era-original .bg-active { background-image: url('https://static.wikia.nocookie.net/xbox/images/4/49/The-original-dynamic-background.gif/revision/latest?cb=20220323013547'); opacity: 0.4; }
        
        .era-blades { background-color: #1e293b; }
        .era-blades .bg-active { background-image: url('https://i.redd.it/ijpbtu5dd3211.gif'); opacity: 0.3; }
        
        .era-nxe { background-color: #334155; }
        .era-nxe .bg-active { background-image: url('https://static.wikia.nocookie.net/xbox/images/e/ec/Xbox360-dynamic-background.gif/revision/latest?cb=20220323020528'); opacity: 0.4; }
        
        .era-metro { background-color: #064e3b; }
        .era-metro .bg-active { background-image: url('https://i.redd.it/ctownureqwl91.gif'); opacity: 0.3; }

        /* Custom UI Elements */
        .glass-panel {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        #result-img { 
            image-rendering: pixelated; 
            box-shadow: 0 0 30px rgba(16, 124, 16, 0.2);
        }

        .tab-btn.active {
            background: #107c10;
            color: white;
            box-shadow: 0 0 20px rgba(16, 124, 16, 0.4);
        }
    </style>
</head>
<body class="era-blades text-slate-100 min-h-screen overflow-x-hidden">

    <div class="bg-overlay bg-active"></div>

    <!-- HEADER DOCK -->
    <header class="fixed top-0 left-0 right-0 z-[2000] border-b border-white/10 backdrop-blur-xl py-3 px-6 flex justify-between items-center bg-black/40">
        <div class="flex items-center gap-4">
            <span id="clock" class="bg-black/40 border border-white/10 text-[11px] font-mono px-3 py-1.5 rounded-lg text-green-500">
                00:00:00
            </span>
        </div>
        
        <div class="flex items-center gap-2">
            <a href="https://heatinthedesertguy.netlify.app/" class="w-10 h-10 flex items-center justify-center rounded-xl bg-white/5 border border-white/10 hover:bg-green-600 hover:text-white transition-all">
                <i data-lucide="home" class="w-[18px]"></i>
            </a>
            <div class="w-[1px] h-6 bg-white/10 mx-2"></div>
            <button id="themeToggle" class="w-10 h-10 flex items-center justify-center rounded-xl bg-white/5 border border-white/10 text-amber-400">
                <i data-lucide="sun" class="w-[18px]"></i>
            </button>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="pt-32 pb-20 px-6 max-w-6xl mx-auto">
        
        <div class="text-center mb-12">
            <h1 class="text-4xl md:text-6xl font-bold font-brand mb-4 flex items-center justify-center gap-4">
                <i data-lucide="monitor" class="text-green-500 w-10 h-10 md:w-14 md:h-14"></i>
                PFP Downgrader <span class="text-green-500">V2</span>
            </h1>
            <p class="text-slate-400 max-w-xl mx-auto">Digitally degrade your profile pictures to match the aesthetic limitations of classic Xbox hardware.</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <!-- Sidebar Controls -->
            <div class="lg:col-span-4 space-y-6">
                <div class="glass-panel rounded-[32px] p-6 space-y-6">
                    <div class="space-y-3">
                        <label class="text-[10px] uppercase font-bold tracking-widest text-slate-500">Selection Era</label>
                        <div class="grid grid-cols-2 gap-2" id="eraGrid">
                            <button data-era="original" class="tab-btn p-3 rounded-2xl border border-white/5 bg-white/5 text-xs font-bold hover:bg-white/10 transition-all text-center">OG XBOX</button>
                            <button data-era="blades" class="tab-btn active p-3 rounded-2xl border border-white/5 bg-white/5 text-xs font-bold hover:bg-white/10 transition-all text-center">BLADES</button>
                            <button data-era="nxe" class="tab-btn p-3 rounded-2xl border border-white/5 bg-white/5 text-xs font-bold hover:bg-white/10 transition-all text-center">NXE</button>
                            <button data-era="metro" class="tab-btn p-3 rounded-2xl border border-white/5 bg-white/5 text-xs font-bold hover:bg-white/10 transition-all text-center">METRO</button>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <label class="text-[10px] uppercase font-bold tracking-widest text-slate-500">Image Source</label>
                        <label for="fileInput" class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-white/10 rounded-3xl hover:border-green-500/50 hover:bg-green-500/5 transition-all cursor-pointer group">
                            <i data-lucide="upload-cloud" class="text-slate-500 group-hover:text-green-500 mb-2 transition-colors"></i>
                            <span class="text-xs font-bold text-slate-400 group-hover:text-white">Choose Frequency</span>
                            <input type="file" id="fileInput" class="hidden" accept="image/*">
                        </label>
                    </div>

                    <button id="processBtn" disabled class="w-full py-4 bg-green-600 disabled:opacity-30 disabled:grayscale text-white rounded-2xl font-bold font-brand shadow-xl shadow-green-900/20 hover:scale-[1.02] active:scale-95 transition-all flex items-center justify-center gap-2">
                        <i data-lucide="zap" class="w-5"></i> GENERATE DEGRADATION
                    </button>
                </div>

                <div class="glass-panel rounded-[32px] p-4 flex items-center gap-4 opacity-60">
                    <div class="w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center text-green-500">
                        <i data-lucide="info" class="w-5"></i>
                    </div>
                    <p class="text-[11px] leading-relaxed">System uses local Canvas buffer for processing. Your data never leaves the desert.</p>
                </div>
            </div>

            <!-- Preview Area -->
            <div class="lg:col-span-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Original -->
                <div class="glass-panel rounded-[40px] p-2 flex flex-col">
                    <div class="p-6 pb-2">
                        <h3 class="text-xs font-bold uppercase tracking-widest text-slate-500">Input Stream</h3>
                    </div>
                    <div class="flex-1 min-h-[300px] flex items-center justify-center p-6">
                        <div id="previewContainer" class="relative w-full aspect-square rounded-2xl overflow-hidden bg-black/20 border border-white/5">
                            <img id="previewImg" src="" class="hidden w-full h-full object-cover">
                            <div id="previewPlaceholder" class="absolute inset-0 flex flex-col items-center justify-center text-slate-600 italic text-sm">
                                <i data-lucide="image" class="w-12 h-12 mb-2 opacity-20"></i>
                                Waiting for signal...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Result -->
                <div class="glass-panel rounded-[40px] p-2 flex flex-col border-green-500/20">
                    <div class="p-6 pb-2 flex justify-between items-center">
                        <h3 class="text-xs font-bold uppercase tracking-widest text-green-500">Degraded Output</h3>
                        <a id="downloadBtn" href="#" download="xbox_pfp_v2.jpg" class="hidden text-green-500 hover:text-white transition-colors">
                            <i data-lucide="download" class="w-5"></i>
                        </a>
                    </div>
                    <div class="flex-1 min-h-[300px] flex items-center justify-center p-6">
                        <div class="relative w-full aspect-square rounded-2xl overflow-hidden bg-black/20 border border-white/5 flex items-center justify-center">
                            <img id="resultImg" src="" class="hidden w-full h-full object-contain">
                            <div id="resultPlaceholder" class="absolute inset-0 flex flex-col items-center justify-center text-slate-600 italic text-sm">
                                <i data-lucide="cpu" class="w-12 h-12 mb-2 opacity-20"></i>
                                Output pending...
                            </div>
                            <!-- Loading Overlay -->
                            <div id="loader" class="hidden absolute inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center">
                                <i data-lucide="refresh-cw" class="animate-spin text-green-500"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <canvas id="procCanvas" class="hidden"></canvas>

    <script>
        // --- System State ---
        let currentEra = 'blades';
        let originalImage = null;

        const eraConfigs = {
            'original': { size: 64, quality: 0.15, smooth: false, filter: 'grayscale(100%) brightness(1.1) contrast(1.2)' },
            'blades': { size: 96, quality: 0.35, smooth: false, filter: 'none' },
            'nxe': { size: 128, quality: 0.45, smooth: true, filter: 'none' },
            'metro': { size: 192, quality: 0.75, smooth: true, filter: 'none' }
        };

        const dom = {
            fileInput: document.getElementById('fileInput'),
            processBtn: document.getElementById('processBtn'),
            previewImg: document.getElementById('previewImg'),
            resultImg: document.getElementById('resultImg'),
            previewPlaceholder: document.getElementById('previewPlaceholder'),
            resultPlaceholder: document.getElementById('resultPlaceholder'),
            downloadBtn: document.getElementById('downloadBtn'),
            loader: document.getElementById('loader'),
            canvas: document.getElementById('procCanvas'),
            eraBtns: document.querySelectorAll('[data-era]'),
            clock: document.getElementById('clock')
        };

        // --- Core Logic ---
        function init() {
            lucide.createIcons();
            startClock();
            setupEventListeners();
        }

        function startClock() {
            setInterval(() => {
                dom.clock.innerText = new Date().toLocaleTimeString();
            }, 1000);
        }

        function setupEventListeners() {
            // Era Selection
            dom.eraBtns.forEach(btn => {
                btn.onclick = () => {
                    dom.eraBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentEra = btn.dataset.era;
                    document.body.className = `era-${currentEra} text-slate-100 min-h-screen overflow-x-hidden`;
                };
            });

            // File Handling
            dom.fileInput.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    originalImage = event.target.result;
                    dom.previewImg.src = originalImage;
                    dom.previewImg.classList.remove('hidden');
                    dom.previewPlaceholder.classList.add('hidden');
                    dom.processBtn.disabled = false;
                };
                reader.readAsDataURL(file);
            };

            // Processing
            dom.processBtn.onclick = processImage;
        }

        function processImage() {
            if (!originalImage) return;

            dom.loader.classList.remove('hidden');
            const config = eraConfigs[currentEra];
            const img = new Image();

            img.onload = () => {
                const ctx = dom.canvas.getContext('2d');
                dom.canvas.width = config.size;
                dom.canvas.height = config.size;

                ctx.imageSmoothingEnabled = config.smooth;
                
                // Square crop logic
                const minSide = Math.min(img.width, img.height);
                const sx = (img.width - minSide) / 2;
                const sy = (img.height - minSide) / 2;

                ctx.filter = config.filter;
                ctx.drawImage(img, sx, sy, minSide, minSide, 0, 0, config.size, config.size);

                const resultData = dom.canvas.toDataURL('image/jpeg', config.quality);
                
                dom.resultImg.src = resultData;
                dom.resultImg.classList.remove('hidden');
                dom.resultPlaceholder.classList.add('hidden');
                dom.downloadBtn.href = resultData;
                dom.downloadBtn.classList.remove('hidden');
                
                setTimeout(() => dom.loader.classList.add('hidden'), 400);
            };
            img.src = originalImage;
        }

        window.onload = init;
    </script>
</body>
</html>
