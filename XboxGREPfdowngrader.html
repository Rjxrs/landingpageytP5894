        <!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xbox PFP Downgrader | Official</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        :root {
            --brand-primary: #ff3e3e; 
            --brand-secondary: #7000ff; 
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.1);
            --bg-dark: #050507;
            --card-radius: 24px;
            --transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            --xbox-green: #107c10;
        }

        [data-bs-theme="dark"] {
            --bg-dark: #050507;
            --bg-card: #0c0c0e;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.12);
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
        }

        [data-bs-theme="light"] {
            --bg-dark: #f1f5f9;
            --bg-card: #ffffff;
            --glass-bg: rgba(0, 0, 0, 0.03);
            --glass-border: rgba(0, 0, 0, 0.08);
            --text-main: #0f172a;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            padding-top: 80px;
            overflow-x: hidden;
            transition: background-color 0.3s ease;
        }

        h1, h2, h3, .nav-link, .font-brand {
            font-family: 'Space Grotesk', sans-serif;
            letter-spacing: -0.02em;
        }

        /* 1:1 Navigation Header from index.html */
        .header-dock {
            background: rgba(var(--bg-dark), 0.85);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            padding: 12px 0;
            position: fixed;
            top: 0; left: 0; right: 0;
            z-index: 2000;
        }

        .tool-link {
            width: 42px; height: 42px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 12px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-main);
            text-decoration: none;
            transition: var(--transition);
        }

        .tool-link:hover {
            transform: translateY(-3px);
            background: var(--brand-primary);
            color: white;
            border-color: var(--brand-primary);
            box-shadow: 0 10px 20px rgba(255, 62, 62, 0.3);
        }

        .theme-toggle-v2 {
            cursor: pointer;
            width: 42px; height: 42px;
            display: flex; align-items: center; justify-content: center;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: var(--text-main);
        }

        /* App-Specific Styling */
        .bg-overlay {
            position: fixed; inset: 0; z-index: -1;
            background-size: cover; background-position: center;
            transition: opacity 1s ease-in-out;
        }

        .era-original { background-color: #000; }
        .era-original .bg-active { background-image: url('https://static.wikia.nocookie.net/xbox/images/4/49/The-original-dynamic-background.gif/revision/latest?cb=20220323013547'); opacity: 0.4; }
        .era-blades { background-color: #1e293b; }
        .era-blades .bg-active { background-image: url('https://i.redd.it/ijpbtu5dd3211.gif'); opacity: 0.3; }
        .era-nxe { background-color: #334155; }
        .era-nxe .bg-active { background-image: url('https://static.wikia.nocookie.net/xbox/images/e/ec/Xbox360-dynamic-background.gif/revision/latest?cb=20220323020528'); opacity: 0.4; }
        .era-metro { background-color: #064e3b; }
        .era-metro .bg-active { background-image: url('https://i.redd.it/ctownureqwl91.gif'); opacity: 0.3; }

        .app-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--card-radius);
            padding: 24px;
        }

        .tab-btn {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-main);
            font-size: 0.75rem;
            font-weight: 700;
            padding: 12px;
            border-radius: 12px;
            transition: var(--transition);
        }

        .tab-btn.active {
            background: var(--xbox-green);
            color: white;
            border-color: var(--xbox-green);
            box-shadow: 0 0 15px rgba(16, 124, 16, 0.4);
        }

        #resultImg { image-rendering: pixelated; }

        .loader {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 16px;
            z-index: 10;
        }
    </style>
</head>
<body class="era-blades">

    <div class="bg-overlay bg-active"></div>

    <!-- 1:1 HEADER DOCK FROM INDEX.HTML -->
    <header class="header-dock">
        <div class="container d-flex justify-content-between align-items-center">
            <span id="live-clock" class="badge bg-dark border border-secondary fw-normal py-2 px-3">00:00:00</span>

            <div class="d-flex align-items-center gap-2">
                <a href="https://heatinthedesertguy.netlify.app/pulsepathv2.html" class="tool-link" title="PulsePath"><i class="fas fa-heart-pulse"></i></a>
                <a href="https://heatinthedesertguy.netlify.app/mp3%20player.html" class="tool-link" title="Music"><i class="fas fa-compact-disc"></i></a>
                <a href="https://heatinthedesertguy.netlify.app/XboxGREPfdowngrader.html" class="tool-link" title="Xbox"><i class="fab fa-xbox"></i></a>
                <a href="https://heatinthedesertguy.netlify.app/faceswapv1.html" class="tool-link" title="AI Swap"><i class="fas fa-wand-magic-sparkles"></i></a>
                <div class="vr mx-2 opacity-25"></div>
                <div class="theme-toggle-v2" id="themeBtn"><i class="fas fa-moon" id="themeIcon"></i></div>
            </div>
        </div>
    </header>

    <main class="container py-5 mt-4">
        <div class="text-center mb-5">
            <h1 class="display-4 fw-bold mb-2">PFP Downgrader <span style="color: var(--xbox-green)">V2</span></h1>
            <p class="text-muted small italic">Vintage profile encoding for the modern era.</p>
        </div>

        <div class="row g-4">
            <!-- Sidebar Controls -->
            <div class="col-lg-4">
                <div class="app-card h-100">
                    <div class="mb-4">
                        <label class="small text-uppercase fw-bold opacity-50 mb-3 d-block">Hardware Target</label>
                        <div class="grid d-flex flex-wrap gap-2">
                            <button data-era="original" class="tab-btn flex-fill">XBOX '01</button>
                            <button data-era="blades" class="tab-btn flex-fill active">BLADES '05</button>
                            <button data-era="nxe" class="tab-btn flex-fill">NXE '08</button>
                            <button data-era="metro" class="tab-btn flex-fill">METRO '13</button>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="small text-uppercase fw-bold opacity-50 mb-3 d-block">Media Input</label>
                        <label for="fileInput" class="w-100 d-flex flex-column align-items-center justify-content-center p-5 border border-dashed rounded-4 cursor-pointer" style="border-color: var(--glass-border); background: rgba(255,255,255,0.02);">
                            <i class="fas fa-cloud-upload-alt mb-2 fa-2x opacity-50"></i>
                            <span class="small fw-bold opacity-75">UPLOAD IMAGE</span>
                            <input type="file" id="fileInput" class="d-none" accept="image/*">
                        </label>
                    </div>

                    <button id="processBtn" disabled class="btn w-100 py-3 fw-bold rounded-4" style="background: var(--xbox-green); color: white;">
                        <i class="fas fa-bolt me-2"></i>PROCESS BUFFER
                    </button>
                </div>
            </div>

            <!-- Previews -->
            <div class="col-lg-8">
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="app-card text-center">
                            <h6 class="small text-uppercase fw-bold opacity-50 mb-3"><i class="fas fa-camera me-2"></i>Raw Input</h6>
                            <div class="ratio ratio-1x1 bg-dark rounded-4 overflow-hidden border border-secondary border-opacity-10 d-flex align-items-center justify-content-center">
                                <img id="previewImg" class="d-none w-100 h-100 object-fit-cover">
                                <div id="previewPlaceholder" class="opacity-25 small italic">WAITING FOR FEED...</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="app-card text-center" style="border-color: rgba(16, 124, 16, 0.2);">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="small text-uppercase fw-bold" style="color: var(--xbox-green)"><i class="fas fa-microchip me-2"></i>Output</h6>
                                <a id="downloadBtn" href="#" download="xbox_legacy_pfp.jpg" class="d-none text-success"><i class="fas fa-download"></i></a>
                            </div>
                            <div class="ratio ratio-1x1 bg-dark rounded-4 overflow-hidden border border-secondary border-opacity-10 d-flex align-items-center justify-content-center position-relative">
                                <img id="resultImg" class="d-none w-100 h-100 object-fit-contain">
                                <div id="resultPlaceholder" class="opacity-25 small italic">READY TO ENCODE</div>
                                <div id="loader" class="loader d-none">
                                    <i class="fas fa-sync fa-spin fa-2x text-success"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <canvas id="procCanvas" class="d-none"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const eraConfigs = {
            'original': { size: 64, quality: 0.15, smooth: false, filter: 'grayscale(100%) brightness(1.1) contrast(1.2)' },
            'blades': { size: 96, quality: 0.35, smooth: false, filter: 'none' },
            'nxe': { size: 128, quality: 0.45, smooth: true, filter: 'none' },
            'metro': { size: 192, quality: 0.75, smooth: true, filter: 'none' }
        };

        let currentEra = 'blades';
        let originalImage = null;

        const dom = {
            fileInput: document.getElementById('fileInput'),
            processBtn: document.getElementById('processBtn'),
            previewImg: document.getElementById('previewImg'),
            resultImg: document.getElementById('resultImg'),
            previewPlaceholder: document.getElementById('previewPlaceholder'),
            resultPlaceholder: document.getElementById('resultPlaceholder'),
            downloadBtn: document.getElementById('downloadBtn'),
            loader: document.getElementById('loader'),
            canvas: document.getElementById('procCanvas'),
            eraBtns: document.querySelectorAll('[data-era]'),
            clock: document.getElementById('live-clock'),
            themeBtn: document.getElementById('themeBtn')
        };

        function startClock() {
            const update = () => { dom.clock.innerText = new Date().toLocaleTimeString(); };
            update();
            setInterval(update, 1000);
        }

        function init() {
            startClock();

            // 1:1 Theme Toggle Logic from index
            dom.themeBtn.onclick = () => {
                const html = document.documentElement;
                const isDark = html.getAttribute('data-bs-theme') === 'dark';
                html.setAttribute('data-bs-theme', isDark ? 'light' : 'dark');
                document.getElementById('themeIcon').className = isDark ? 'fas fa-sun' : 'fas fa-moon';
            };

            dom.eraBtns.forEach(btn => {
                btn.onclick = () => {
                    dom.eraBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentEra = btn.dataset.era;
                    document.body.className = `era-${currentEra}`;
                };
            });

            dom.fileInput.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    originalImage = event.target.result;
                    dom.previewImg.src = originalImage;
                    dom.previewImg.classList.remove('d-none');
                    dom.previewPlaceholder.classList.add('d-none');
                    dom.processBtn.disabled = false;
                };
                reader.readAsDataURL(file);
            };

            dom.processBtn.onclick = () => {
                dom.loader.classList.remove('d-none');
                const config = eraConfigs[currentEra];
                const img = new Image();
                img.onload = () => {
                    const ctx = dom.canvas.getContext('2d');
                    dom.canvas.width = config.size;
                    dom.canvas.height = config.size;
                    ctx.imageSmoothingEnabled = config.smooth;
                    const minSide = Math.min(img.width, img.height);
                    const sx = (img.width - minSide) / 2;
                    const sy = (img.height - minSide) / 2;
                    ctx.filter = config.filter;
                    ctx.drawImage(img, sx, sy, minSide, minSide, 0, 0, config.size, config.size);
                    const resultData = dom.canvas.toDataURL('image/jpeg', config.quality);
                    dom.resultImg.src = resultData;
                    dom.resultImg.classList.remove('d-none');
                    dom.resultPlaceholder.classList.add('d-none');
                    dom.downloadBtn.href = resultData;
                    dom.downloadBtn.classList.remove('d-none');
                    setTimeout(() => dom.loader.classList.add('d-none'), 600);
                };
                img.src = originalImage;
            };
        }

        window.onload = init;
    </script>
</body>
</html>
